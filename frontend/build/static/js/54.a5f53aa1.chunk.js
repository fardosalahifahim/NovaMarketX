"use strict";(self.webpackChunkanimespring=self.webpackChunkanimespring||[]).push([[54],{5054:(e,s,r)=>{r.r(s),r.d(s,{default:()=>c});var n=r(5043),t=r(9722),a=r(2407),o=r(3216),i=r(579);const c=()=>{const[e,s]=(0,n.useState)([]),[r,c]=(0,n.useState)(""),[l,d]=(0,n.useState)(null),[u,g]=(0,n.useState)([]),m=(0,n.useRef)(null),h=(0,a.xI)(),p=(0,o.zy)().search;let f=null;p.startsWith("?")&&(f=p.substring(1));const v=()=>f||(l?l.uid:null);(0,n.useEffect)(()=>{const e=(0,a.hg)(h,e=>{d(e)});return x(),S(),()=>e()},[f,l]);const S=()=>{const e=v();if(!e)return void console.log("No user ID available for real-time connection");y(e);const r=new EventSource("http://localhost:5000/api/messages/stream?userId=".concat(e));return r.onmessage=e=>{try{const r=JSON.parse(e.data);console.log("Received real-time message:",r),Array.isArray(r)?s(r):s(e=>e.some(e=>e.id===r.id)?e:[...e,r]),j()}catch(r){console.error("Error parsing real-time message:",r)}},r.onerror=e=>{console.error("SSE error:",e)},()=>{r.close()}},y=async e=>{try{if(!e)return;const r=await t.A.get("http://localhost:5000/api/messages?userId=".concat(e));s(r.data),j()}catch(r){console.error("Error fetching FAQ messages:",r)}},x=async()=>{try{const e=await t.A.get("http://localhost:5000/api/users");g(e.data)}catch(e){console.error("Error fetching users:",e)}},j=()=>{m.current&&m.current.scrollIntoView({behavior:"smooth"})},w=e=>{const s=u.find(s=>String(s.id)===String(e)||s.uid===String(e));if(s)return s.username;if(l&&(String(l.uid)===String(e)||String(l.id)===String(e)))return l.displayName||l.email||"Authenticated User";if(e){const s=u.find(s=>s.uid===String(e));if(s)return s.username;if(e.includes("@")){const s=u.find(s=>s.email===e);if(s)return s.username}}return"Unknown User"},A=e=>{const s=v();return!!s&&e===s},E=async()=>{const e=v();if(r.trim()&&e)try{const s=e,n="animespring",a=await t.A.post("http://localhost:5000/api/faq-messages",{content:r,senderId:s,receiverId:n});console.log("Message sent response:",a.data),c("")}catch(a){var s,n;console.error("Error sending FAQ message:",a),alert("Error sending message: "+((null===(s=a.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.error)||"Unknown error"))}};return(0,i.jsxs)("div",{className:"faq-help-chat-container",children:[(0,i.jsx)("h2",{children:"FAQ & Help Chat"}),(0,i.jsxs)("div",{className:"messages-container",children:[e.map(e=>(0,i.jsxs)("div",{className:"message-item ".concat(A(e.senderId)?"sent":"received"),children:[(0,i.jsx)("div",{className:"message-username",children:w(e.senderId)}),(0,i.jsx)("div",{className:"message-content",children:e.content})]},e.id)),(0,i.jsx)("div",{ref:m})]}),(0,i.jsxs)("div",{className:"input-container",children:[(0,i.jsx)("textarea",{value:r,onChange:e=>{c(e.target.value)},onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),E())},placeholder:"Type your message...",rows:3}),(0,i.jsx)("button",{onClick:E,children:"Send"})]})]})}}}]);
//# sourceMappingURL=54.a5f53aa1.chunk.js.map